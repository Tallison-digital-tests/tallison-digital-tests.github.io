<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Digital Test Environment</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/fontAwesome.css">
        <link rel="stylesheet" href="css/hero-slider.css">
        <link rel="stylesheet" href="css/owl-carousel.css">
        <link rel="stylesheet" href="css/templatemo-style.css">

        <link href="https://fonts.googleapis.com/css?family=Spectral:200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">


        <script type="text/javascript" src="https://resources.digital-cloud-west.medallia.com/wdcwest/23517/onsite/embed.js" async></script>
        <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    </head>

<body>
    <div class="header">
        <div class="container">
            <a href="#" class="navbar-brand scroll-top">Anywhere</a>
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="navbar-header">
                    <button type="button" id="nav-toggle" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <!--/.navbar-header-->
                <div id="main-nav" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="index.html">Always-On</a></li>
                        <li><a href="menu.html">Intercept</a></li>
                        <li><a href="blog.html">Behaviour</a></li>
                        <li><a href="contact.html">Anywhere</a></li>
                    </ul>
                </div>
                <!--/.navbar-collapse-->
            </nav>
            <!--/.navbar-->
        </div>
        <!--/.container-->
    </div>
    <!--/.header-->


    <section class="page-heading">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>Anywhere</h1>
                    <p>Show stopper, quase magia. Mas citando uma antiga feiticeira: não é magia, é tecnologia.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="Digital Anywhere — Demo">
        <div class="container">

  <div class="row">
    <label for="propertyToken"><strong>Property token</strong></label>
    <input id="propertyToken" type="password" placeholder="cole aqui seu token (NÃO use em produção!)" />
  </div>

  <div class="row">
    <label for="apiBase"><strong>API Base</strong></label>
    <input id="apiBase" type="text" value="https://bradesco.md-apis.medallia.com/publicAPI/v2" />
    <span class="badge">publicAPI/v2</span>
  </div>

  <div class="row">
    <label for="formId"><strong>Form ID</strong></label>
    <input id="formId" type="number" value="25771" />
  </div>

  <button id="startBtn">Abrir Digital Anywhere</button>

  <h3>Log</h3>
  <div id="log"></div>

  <!-- Modal simples para renderizar o formulário -->
  <div id="formModal" role="dialog" aria-modal="true">
    <div id="formCard">
      <h2 id="formTitle">Form</h2>
      <form id="dynamicForm"></form>
      <div class="actions">
        <button id="submitBtn" type="button">Enviar</button>
        <button id="closeBtn" type="button">Fechar</button>
      </div>
      <div id="formMsg" class="muted"></div>
    </div>
  </div>


            
<script>
(function(){
  const logEl = document.getElementById('log');
  const modal = document.getElementById('formModal');
  const formEl = document.getElementById('dynamicForm');
  const formTitleEl = document.getElementById('formTitle');
  const formMsgEl = document.getElementById('formMsg');

// use o domínio do seu projeto no Vercel
const proxyBase = 'https://medallia-anywhere-proxy.vercel.app/api';

// troca de token
async function getAccessToken(_, propertyToken) {
  const res = await fetch(`${proxyBase}/accessToken`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ token: propertyToken })
  });
  if (!res.ok) throw new Error(`accessToken falhou: ${res.status}`);
  const data = await res.json();
  return data.accessToken || data.token || data.access_token;
}

// configuration
async function getConfiguration(_, accessToken, formId) {
  const res = await fetch(`${proxyBase}/configuration?formId=${encodeURIComponent(formId)}&accessToken=${encodeURIComponent(accessToken)}`);
  if (!res.ok) throw new Error(`configuration falhou: ${res.status}`);
  return res.json();
}

// feedback
async function sendFeedback(_, accessToken, payload) {
  const res = await fetch(`${proxyBase}/feedback`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ accessToken, ...payload })
  });
  if (!res.ok) throw new Error(`feedback falhou: ${res.status}`);
  return res.json().catch(() => ({}));
}
    
  function log(msg, kind) {
    const prefix = kind === 'err' ? '❌ ' : kind === 'ok' ? '✅ ' : '• ';
    logEl.textContent += prefix + (typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2)) + '\n';
  }

  function showModal() { modal.style.display = 'flex'; }
  function hideModal() { modal.style.display = 'none'; formEl.innerHTML=''; formMsgEl.textContent=''; }

  // === API calls ===
  async function getAccessToken(apiBase, propertyToken) {
    const url = apiBase.replace(/\/$/, '') + '/accessToken';
    // Payload mais comum para Anywhere: { token: "<PROPERTY_TOKEN>" }
    // (Algumas instâncias podem exigir Authorization header. Ajuste se necessário.)
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token: propertyToken })
    });
    if (!res.ok) throw new Error(`accessToken falhou: ${res.status} ${res.statusText}`);
    const data = await res.json();
    // Suporte a chaves diferentes (ex.: accessToken | token | access_token)
    const at = data.accessToken || data.token || data.access_token;
    if (!at) throw new Error('Resposta sem accessToken. Veja o console:\n' + JSON.stringify(data));
    return at;
  }

  async function getConfiguration(apiBase, accessToken, formId) {
    const url = apiBase.replace(/\/$/, '') + `/configuration?formId=${encodeURIComponent(formId)}`;
    const res = await fetch(url, {
      headers: { 'Authorization': `Bearer ${accessToken}` }
    });
    if (!res.ok) throw new Error(`configuration falhou: ${res.status} ${res.statusText}`);
    const data = await res.json();
    return data;
  }

  async function sendFeedback(apiBase, accessToken, payload) {
    const url = apiBase.replace(/\/$/, '') + '/feedback';
    const res = await fetch(url, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const errText = await res.text().catch(()=> '');
      throw new Error(`feedback falhou: ${res.status} ${res.statusText}\n${errText}`);
    }
    return res.json().catch(() => ({}));
  }

  // === Form rendering (genérico) ===
  function normalizeFields(config) {
    // Tenta localizar a lista de campos nos formatos mais comuns
    // Exemplos possíveis: config.form.fields, config.fields, config.formDefinition.fields
    const form = config.form || config.formDefinition || config;
    const title = form.name || form.title || `Form ${form.id || ''}`;
    const fields = form.fields || [];
    return { title, fields, raw: config };
  }

  function createInputForField(field) {
    // Campos típicos: text, textarea, select, number, rating, radio, checkbox, email, phone...
    const wrap = document.createElement('div'); wrap.className = 'row';
    const label = document.createElement('label');
    const id = `f_${field.id || field.name || Math.random().toString(36).slice(2)}`;
    label.setAttribute('for', id);
    label.textContent = field.label || field.name || field.id || 'Campo';

    let input;
    const type = (field.type || '').toLowerCase();

    if (type.includes('text') && !type.includes('multi')) {
      input = document.createElement('input'); input.type = 'text';
    } else if (type.includes('multi') || type.includes('textarea')) {
      input = document.createElement('textarea'); input.rows = 3;
    } else if (type.includes('email')) {
      input = document.createElement('input'); input.type = 'email';
    } else if (type.includes('phone')) {
      input = document.createElement('input'); input.type = 'tel';
    } else if (type.includes('number') || type.includes('rating')) {
      input = document.createElement('input'); input.type = 'number';
    } else if (type.includes('select') || Array.isArray(field.options)) {
      input = document.createElement('select');
      const opts = field.options || [];
      const ph = document.createElement('option'); ph.value=''; ph.textContent='— selecione —';
      input.appendChild(ph);
      opts.forEach(opt => {
        const o = document.createElement('option');
        o.value = (opt.value ?? opt.id ?? opt); o.textContent = (opt.label ?? opt.name ?? String(opt));
        input.appendChild(o);
      });
    } else if (type.includes('boolean') || type.includes('checkbox')) {
      input = document.createElement('input'); input.type = 'checkbox';
    } else {
      // fallback: text
      input = document.createElement('input'); input.type = 'text';
    }

    input.id = id;
    input.dataset.fieldId = field.id || field.name || id;
    if (field.required) input.required = true;

    wrap.appendChild(label);
    wrap.appendChild(input);
    return wrap;
  }

  function collectAnswers() {
    const controls = formEl.querySelectorAll('[data-field-id]');
    const answers = [];
    controls.forEach(ctrl => {
      const fieldId = ctrl.dataset.fieldId;
      let value;
      if (ctrl.type === 'checkbox') value = ctrl.checked;
      else value = ctrl.value;

      answers.push({ fieldId, value });
    });
    return answers;
  }

  // === Wire UI ===
  document.getElementById('startBtn').addEventListener('click', async () => {
    log('Iniciando fluxo...');
    const apiBase = document.getElementById('apiBase').value.trim();
    const propertyToken = document.getElementById('propertyToken').value.trim();
    const formId = document.getElementById('formId').value.trim();

    if (!apiBase || !propertyToken || !formId) {
      log('Preencha API Base, Property token e Form ID.', 'err');
      return;
    }

    try {
      log('Trocando property token por accessToken...');
      const accessToken = await getAccessToken(apiBase, propertyToken);
      log('Access token OK.', 'ok');

      log(`Buscando configuration do form ${formId}...`);
      const conf = await getConfiguration(apiBase, accessToken, formId);
      log(conf);

      const { title, fields } = normalizeFields(conf);
      formTitleEl.textContent = title || `Form ${formId}`;

      // Monta o form dinâmico
      formEl.innerHTML = '';
      if (!fields || !fields.length) {
        const div = document.createElement('div');
        div.className = 'error';
        div.textContent = 'Nenhum campo encontrado na configuração. Veja o LOG acima para inspecionar a resposta.';
        formEl.appendChild(div);
      } else {
        fields.forEach(f => formEl.appendChild(createInputForField(f)));
      }

      // Abre modal
      showModal();

      // Submit
      document.getElementById('submitBtn').onclick = async () => {
        formMsgEl.textContent = 'Enviando...';
        try {
          const answers = collectAnswers();
          const payload = {
            formId: Number(formId),
            // Algumas instâncias esperam "responses", outras "answers".
            responses: answers,
            // metadata útil — ajuste conforme necessidade
            channel: 'anywhere',
            locale: 'pt-BR'
          };
          log('Payload de feedback:'); log(payload);

          const res = await sendFeedback(apiBase, accessToken, payload);
          formMsgEl.textContent = '';
          log('Feedback enviado com sucesso!', 'ok');
          log(res);
          formMsgEl.innerHTML = '<span class="success">Feedback enviado com sucesso!</span>';
        } catch (e) {
          formMsgEl.innerHTML = '<span class="error">Falha ao enviar feedback. Veja o log.</span>';
          log(e.message || e, 'err');
        }
      };

      // Close
      document.getElementById('closeBtn').onclick = () => hideModal();

    } catch (e) {
      log(e.message || e, 'err');
      if ((e.message || '').includes('Failed to fetch')) {
        log('Possível CORS: rode via um proxy server-side.', 'err');
      }
    }
  });
})();
</script>
        </div>
    </section>

    
    <section class="contact-us">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="section-heading">
                        <h2>Message</h2>
                    </div>
                    <form id="contact" action="" method="post">
                        <div class="row">
                            <div class="col-md-6">
                                <fieldset>
                                    <input name="name" type="text" class="form-control" id="name" placeholder="Your name..." required="">
                                </fieldset>
                                <fieldset>
                                    <input name="email" type="text" class="form-control" id="email" placeholder="Your email..." required="">
                                </fieldset>
                                <fieldset>
                                    <input name="phone" type="text" class="form-control" id="phone" placeholder="Your phone..." required="">
                                </fieldset>
                            </div>
                            <div class="col-md-6">
                                <fieldset>
                                    <textarea name="message" rows="6" class="form-control" id="message" placeholder="Your message..." required=""></textarea>
                                </fieldset>
                                <fieldset>
                                    <button type="submit" id="form-submit" class="btn">Send Message</button>
                                </fieldset>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-md-6">
                    <div class="section-heading contact-info">
                        <h2>Contact Info</h2>
                        <p>Pellentesque nec orci in erat venenatis viverra. Vivamus in lorem et leo feugiat ullamcorper. Donec volutpat fermentum erat non aliquet. Cras fermentum, risus a blandit sodales, erat turpis eleifend lacus, venenatis mollis leo lorem vel eros. Quisque et sem tempus, feugiat urna iaculis, tempor metus.<br><br><em>30 Raffles Ave, <br>Singapore 039803</em></p>
                    </div>
                    <p>
                    <button type="submit" id="form-submit" class="btn">Send Message</button>
                        </p>
                </div>
            </div>
        </div>
    </section>



    <section class="map">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div id="map">
        <!-- How to change your own map point
            1. Go to Google Maps
            2. Click on your location point
            3. Click "Share" and choose "Embed map" tab
            4. Copy only URL and paste it within the src="" field below
        -->
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7895.485196115994!2d103.85995441789784!3d1.2880401763270322!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x7fb4e58ad9cd826e!2sSingapore+Flyer!5e0!3m2!1sen!2sth!4v1505825620371" width="100%" height="500" frameborder="0" style="border:0" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>



    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <p>Copyright &copy; 2020 Victory Template</p>
                </div>
                <div class="col-md-4">
                    <ul class="social-icons">
                        <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                        <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                        <li><a href="#"><i class="fa fa-rss"></i></a></li>
                        <li><a href="#"><i class="fa fa-dribbble"></i></a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <p>Design: TemplateMo</p>
                </div>
            </div>
        </div>
    </footer>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.min.js"><\/script>')</script>

    <script src="js/vendor/bootstrap.min.js"></script>

    <script src="js/plugins.js"></script>
    <script src="js/main.js"></script>

    <script type="text/javascript">
    $(document).ready(function() {
        // navigation click actions 
        $('.scroll-link').on('click', function(event){
            event.preventDefault();
            var sectionID = $(this).attr("data-id");
            scrollToID('#' + sectionID, 750);
        });
        // scroll to top action
        $('.scroll-top').on('click', function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop:0}, 'slow');         
        });
        // mobile nav toggle
        $('#nav-toggle').on('click', function (event) {
            event.preventDefault();
            $('#main-nav').toggleClass("open");
        });
    });
    // scroll function
    function scrollToID(id, speed){
        var offSet = 0;
        var targetOffset = $(id).offset().top - offSet;
        var mainNav = $('#main-nav');
        $('html,body').animate({scrollTop:targetOffset}, speed);
        if (mainNav.hasClass("open")) {
            mainNav.css("height", "1px").removeClass("in").addClass("collapse");
            mainNav.removeClass("open");
        }
    }
    if (typeof console === "undefined") {
        console = {
            log: function() { }
        };
    }
    </script>
</body>

</html>





